/* Hijack v1.0.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(d){var g={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||g.isNull(a)||g.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!g.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;
default:return Boolean(a)}},executeFunctionByName:function(a,g){var d=Array.prototype.slice.call(arguments,2);1>d.length&&(d=arguments);for(var b=a.split("."),c=b.pop(),f=window,h=0;h<b.length;h++)f=f[b[h]];try{return f[c].apply(g,d)}catch(e){return alert(e),null}},objectKey:function(a,d,k){if(g.isEmpty(d))return k?k:a;d=d.split(".");for(var b=d.pop(),c;c=d.shift();){if("undefined"===typeof a[c])return;a=a[c]}return k?a[b]=k:a[b]}},n={hrefs:!0,forms:!0,data:null,rehijack:!0,rehijackKey:null,canOverwrite:!0,
target:null,context:null,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){d(this).html(a)},onError:function(a){alert("ERROR: "+a)}};d.extend({hijackSetup:function(a){d.extend(!0,n,a)}});d.fn.hijack=function(a){a=a||{};var j=function(b,a,f){if(!g.isEmpty(b)){g.isEmpty(f)&&(f=arguments);if(d.isFunction(b))return b.apply(a,f);if(g.isString(b)){f=b.split(",");var h=f.shift();return g.executeFunctionByName(h,a,f)}}},k=function(b,a){var f=g.objectKey(b,
a.rehijackKey);g.isEmpty(f)||(f=d(f),f.hijack(a),g.objectKey(b,a.rehijackKey,f));return b};return this.each(function(){var b=d(this),c;if(!g.isEmpty(b.prop("tagName"))){if(!g.isEmpty(b.attr("data-hijack")))try{c=d.parseJSON(b.attr("data-hijack"))}catch(f){console.log(f)}if(g.isBoolean(c)||g.isNumber(c))c={hrefs:c,forms:c};var h=d.extend(!0,{},b.data("hijack"),a,c);h.hrefs=g.stringToBoolean(h.hrefs);h.forms=g.stringToBoolean(h.forms);b.data("hijack",h);var e=d.extend(!0,{},n,h);d("a, form",b).each(function(){h._parent=
b;d(this).hijack(h)});g.isEmpty(e.target)&&(e.target=e._parent||b.parent());if(b.prop("tagName").match(/a/i))a:if(e.hrefs&&b.attr("href")&&!b.attr("href").match(/.*#$/)){if(b.data("_hijacked")){if(!e.canOverwrite)break a;b.unbind("click.hijack").data("_hijacked",!1)}b.bind("click.hijack",function(a){a.preventDefault();var c=d(e.target),f=g.isEmpty(e.context)?c:d(e.context);f._event=a;if(!j(e.confirmHijack,f))return!1;b.trigger("beforeHijack");j(e.beforeHijack,f,[e]);d.ajax({url:this.href,data:e.data,
success:function(a,d,c){f=null;e.rehijack&&(a=k(a,e));g.isEmpty(a.error)?j(e.onSuccess,this,[a,d,c,e]):j(e.onError,this,[a,d,c,e]);b.trigger("afterHijack");j(e.afterHijack,this,[a])},context:f})}).data("_hijacked",!0)}if(b.prop("tagName").match(/form/i))a:if(e.forms){if(b.data("_hijacked")){if(!e.canOverwrite)break a;b.unbind("submit.hijack").data("_hijacked",!1)}var l=b.get(0);for(i=0;i<l.attributes.length;i++)if(l.attributes[i].specified){c=l.attributes[i].nodeName.toString().toLowerCase();var m=
c.match(/^on(submit)/);if(!g.isEmpty(m)){var m=m[1],p=new Function(l.attributes[i].nodeValue.toString());b.removeAttr(c);b.bind(m,function(){return p.apply()});c=d._data(b[0],"events").submit;c.unshift(c.pop())}}b.bind("submit.hijack",function(a){a.preventDefault();if(g.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var c=d._data(b[0],"events").submit;if("hijack"!=c[c.length-1].namespace){a.stopImmediatePropagation();for(var f=0;f<c.length;f++)if("hijack"!=c[f].namespace)c.splice(f,
1),f--;else if("hijack"==c[f].namespace&&f+1!=c.length)return c.push(c.splice(f,1).pop()),b.triggerHandler("submit"),!1}var c=d(e.target),h=g.isEmpty(e.context)?c:d(e.context);h._event=a;if(!j(e.confirmHijack,h))return!1;b.trigger("beforeHijack");j(e.beforeHijack,h,[e]);d.ajax({url:l.action,data:b.serialize()+"&"+d.param(e.data),success:function(a,c,d){h=null;e.rehijack&&(a=k(a,e));g.isEmpty(a.error)?j(e.onSuccess,this,[a,c,d,e]):j(e.onError,this,[a,c,d,e]);b.trigger("afterHijack");j(e.afterHijack,
this,[a])},context:h});return!1}).data("_hijacked",!0)}}})}})(jQuery);