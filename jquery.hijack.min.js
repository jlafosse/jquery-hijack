/* Hijack v1.1.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(d){var f={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||f.isNull(a)||f.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!f.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;
default:return Boolean(a)}},executeFunctionByName:function(a,f){var d=Array.prototype.slice.call(arguments,2);1>d.length&&(d=arguments);for(var b=a.split("."),g=b.pop(),e=window,h=0;h<b.length;h++)e=e[b[h]];try{return e[g].apply(f,d)}catch(c){return alert(c),null}},objectKey:function(a,d,k){if(f.isEmpty(d))return k?k:a;d=d.split(".");for(var b=d.pop(),g;g=d.shift();){if("undefined"===typeof a[g])return;a=a[g]}return k?a[b]=k:a[b]}},n={hrefs:!0,forms:!0,data:{},rehijack:!0,rehijackKey:null,canOverwrite:!0,
target:null,context:null,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){console.log("success:",a)},onError:function(a,d,f){console.log("error:",f)}};d.extend({hijackSetup:function(a){d.extend(!0,n,a)}});d.fn.hijack=function(a){a=a||{};var j=function(b,a,e){if(!f.isEmpty(b)){f.isEmpty(e)&&(e=arguments);if(d.isFunction(b))return b.apply(a,e);if(f.isString(b)){e=b.split(",");var h=e.shift();return f.executeFunctionByName(h,a,e)}}},k=function(b,
a){var e=f.objectKey(b,a.rehijackKey);f.isEmpty(e)||(e=d(e),e.hijack(a),f.objectKey(b,a.rehijackKey,e));return b};return this.each(function(){var b=d(this),g;if(!f.isEmpty(b.prop("tagName"))){if(!f.isEmpty(b.attr("data-hijack")))try{g=d.parseJSON(b.attr("data-hijack"))}catch(e){console.log(e)}if(f.isBoolean(g)||f.isNumber(g))g={hrefs:g,forms:g};var h=d.extend(!0,{},b.data("hijack"),a,g);h.hrefs=f.stringToBoolean(h.hrefs);h.forms=f.stringToBoolean(h.forms);b.data("hijack",h);var c=d.extend(!0,{},n,
h);d("a, form",b).each(function(){h._parent=b;d(this).hijack(h)});f.isEmpty(c.target)&&(c.target=c._parent||b.parent());if(b.prop("tagName").match(/a/i))a:if(c.hrefs&&b.attr("href")&&!b.attr("href").match(/.*#$/)){if(b.data("_hijacked")){if(!c.canOverwrite)break a;b.unbind("click.hijack").data("_hijacked",!1)}b.bind("click.hijack",function(a){a.preventDefault();var g=d(c.target),e=f.isEmpty(c.context)?g:d(c.context);e._event=a;if(!j(c.confirmHijack,e))return!1;b.trigger("beforeHijack");j(c.beforeHijack,
e,[c]);c.url=this.href;c.context=e;d.ajax(d.extend(!0,c,{success:function(a,d,f){e=null;c.rehijack&&(a=k(a,c));j(c.onSuccess,this,[a,d,f,c]);b.trigger("afterHijack");j(c.afterHijack,this,[f,d,c])},error:function(a,b,d){j(c.onError,this,[a,b,d,c])}}))}).data("_hijacked",!0)}if(b.prop("tagName").match(/form/i))a:if(c.forms){if(b.data("_hijacked")){if(!c.canOverwrite)break a;b.unbind("submit.hijack").data("_hijacked",!1)}var l=b.get(0);for(i=0;i<l.attributes.length;i++)if(l.attributes[i].specified){g=
l.attributes[i].nodeName.toString().toLowerCase();var m=g.match(/^on(submit)/);if(!f.isEmpty(m)){var m=m[1],p=new Function(l.attributes[i].nodeValue.toString());b.removeAttr(g);b.bind(m,function(){return p.apply()});g=d._data(b[0],"events").submit;g.unshift(g.pop())}}b.bind("submit.hijack",function(a){a.preventDefault();if(f.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var e=d._data(b[0],"events").submit;if("hijack"!=e[e.length-1].namespace){a.stopImmediatePropagation();for(var g=
0;g<e.length;g++)if("hijack"!=e[g].namespace)e.splice(g,1),g--;else if("hijack"==e[g].namespace&&g+1!=e.length)return e.push(e.splice(g,1).pop()),b.triggerHandler("submit"),!1}var e=d(c.target),h=f.isEmpty(c.context)?e:d(c.context);h._event=a;if(!j(c.confirmHijack,h))return!1;b.trigger("beforeHijack");j(c.beforeHijack,h,[c]);c.url=l.action;c.data=f.isString(c.data)?c.data:d.param(c.data);c.data+="&"+b.serialize();c.context=h;d.ajax(d.extend(!0,c,{success:function(a,d,e){h=null;c.rehijack&&(a=k(a,
c));j(c.onSuccess,this,[a,d,e,c]);b.trigger("afterHijack");j(c.afterHijack,this,[e,d,c])},error:function(a,b,d){j(c.onError,this,[a,b,d,c])}}));return!1}).data("_hijacked",!0)}}})}})(jQuery);