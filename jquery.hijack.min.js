/* Hijack v1.1.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(d){var e={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||e.isNull(a)||e.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!e.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;
default:return Boolean(a)}},executeFunctionByName:function(a,d){var e=Array.prototype.slice.call(arguments,2);1>e.length&&(e=arguments);for(var b=a.split("."),c=b.pop(),h=window,j=0;j<b.length;j++)h=h[b[j]];try{return h[c].apply(d,e)}catch(g){return alert(g),null}},objectKey:function(a,d,l){if(e.isEmpty(d))return l?l:a;d=d.split(".");for(var b=d.pop(),c;c=d.shift();){if("undefined"===typeof a[c])return;a=a[c]}return l?a[b]=l:a[b]}},p={hrefs:!0,forms:!0,data:{},rehijack:!0,rehijackKey:null,canOverwrite:!0,
target:null,context:null,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){console.log("success:",a)},onError:function(a,d,e){console.log("error:",e)}};d.extend({hijackSetup:function(a){d.extend(!0,p,a)}});d.fn.hijack=function(a){a=a||{};var k=function(b,a,h){if(!e.isEmpty(b)){e.isEmpty(h)&&(h=arguments);if(d.isFunction(b))return b.apply(a,h);if(e.isString(b)){h=b.split(",");var j=h.shift();return e.executeFunctionByName(j,a,h)}}},l=function(b,
a){var h=e.objectKey(b,a.rehijackKey);e.isEmpty(h)||(h=d(h),h.hijack(a),e.objectKey(b,a.rehijackKey,h));return b};return this.each(function(){var b=d(this),c;if(!e.isEmpty(b.prop("tagName"))){if(!e.isEmpty(b.attr("data-hijack")))try{c=d.parseJSON(b.attr("data-hijack"))}catch(h){console.log(h)}if(e.isBoolean(c)||e.isNumber(c))c={hrefs:c,forms:c};var j=d.extend(!0,{},b.data("hijack"),a,c);j.hrefs=e.stringToBoolean(j.hrefs);j.forms=e.stringToBoolean(j.forms);b.data("hijack",j);c=d.extend(!0,{},p,j);
d("a, form",b).each(function(){j._parent=b;d(this).hijack(j)});e.isEmpty(c.target)&&(c.target=c._parent||b.parent());if(b.prop("tagName").match(/a/i))a:{var g=c;if(g.hrefs&&b.attr("href")&&!b.attr("href").match(/.*#$/)){if(b.data("_hijacked")){if(!g.canOverwrite)break a;b.unbind("click.hijack").data("_hijacked",!1)}b.bind("click.hijack",function(a){a.preventDefault();var c=d(g.target),f=e.isEmpty(g.context)?c:d(g.context);f._event=a;if(!k(g.confirmHijack,f,[g]))return!1;b.trigger("beforeHijack");
k(g.beforeHijack,f,[g]);g.context=f;g=d.extend(!0,g,{success:function(a,d,e){f=null;g.rehijack&&(a=l(a,g));k(g.onSuccess,this,[a,d,e,g]);b.trigger("afterHijack");k(g.afterHijack,this,[e,d,g])},error:function(a,b,d){k(g.onError,this,[a,b,d,g])}});d.ajax(d.extend({},g,{url:this.href}))}).data("_hijacked",!0)}}if(b.prop("tagName").match(/form/i))a:{var f=c;if(f.forms){if(b.data("_hijacked")){if(!f.canOverwrite)break a;b.unbind("submit.hijack").data("_hijacked",!1)}var m=b.get(0);for(i=0;i<m.attributes.length;i++)if(m.attributes[i].specified){c=
m.attributes[i].nodeName.toString().toLowerCase();var n=c.match(/^on(submit)/);if(!e.isEmpty(n)){var n=n[1],q=new Function(m.attributes[i].nodeValue.toString());b.removeAttr(c);b.bind(n,function(){return q.apply()});c=d._data(b[0],"events").submit;c.unshift(c.pop())}}b.bind("submit.hijack",function(a){a.preventDefault();if(e.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var c=d(f.target),g=e.isEmpty(f.context)?c:d(f.context),c=d._data(b[0],"events").submit;g._event=a;if("hijack"!=
c[c.length-1].namespace){a.stopImmediatePropagation();for(a=0;a<c.length;a++)if("hijack"!=c[a].namespace)c.splice(a,1),a--;else if("hijack"==c[a].namespace&&a+1!=c.length)return c.push(c.splice(a,1).pop()),b.triggerHandler("submit"),!1}if(!k(f.confirmHijack,g,[f]))return!1;b.trigger("beforeHijack");k(f.beforeHijack,g,[f]);f.context=g;f=d.extend(!0,f,{success:function(a,c,d){g=null;f.rehijack&&(a=l(a,f));k(f.onSuccess,this,[a,c,d,f]);b.trigger("afterHijack");k(f.afterHijack,this,[d,c,f])},error:function(a,
b,c){k(f.onError,this,[a,b,c,f])}});d.ajax(d.extend({},f,{url:m.action,data:(e.isString(f.data)?f.data:d.param(f.data))+"&"+b.serialize()}));return!1}).data("_hijacked",!0)}}}})}})(jQuery);