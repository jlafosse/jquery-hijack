/* Hijack v1.0.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(e){var g={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||g.isNull(a)||g.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!g.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1; default:return Boolean(a)}},executeFunctionByName:function(a,g){var e=Array.prototype.slice.call(arguments,2);1>e.length&&(e=arguments);for(var b=a.split("."),f=b.pop(),c=window,d=0;d<b.length;d++)c=c[b[d]];try{return c[f].apply(g,e)}catch(k){return alert(k),null}},objectKey:function(a,e,j){if(g.isEmpty(e))return j?j:a;e=e.split(".");for(var b=e.pop(),f;f=e.shift();){if("undefined"===typeof a[f])return;a=a[f]}return j?a[b]=j:a[b]}},n={hrefs:!0,forms:!0,data:null,rehijack:!0,rehijackKey:null,canOverwrite:!0, target:null,context:null,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){e(this).html(a)},onError:function(a){alert("ERROR: "+a)}};e.extend({hijackSetup:function(a){e.extend(!0,n,a)}});e.fn.hijack=function(a){a=a||{};var h=function(b,a,c){if(!g.isEmpty(b)){g.isEmpty(c)&&(c=arguments);if(e.isFunction(b))return b.apply(a,c);if(g.isString(b)){c=b.split(",");var d=c.shift();return g.executeFunctionByName(d,a,c)}}},j=function(b,a){var c=g.objectKey(b, a.rehijackKey);g.isEmpty(c)||(c=e(c),c.hijack(a),g.objectKey(b,a.rehijackKey,c));return b};return this.each(function(){var b=e(this);if(!g.isEmpty(b.prop("tagName"))){var f=e.parseJSON(b.attr("data-hijack"));if(g.isBoolean(f)||g.isNumber(f))f={hrefs:f,forms:f};var c=e.extend(!0,{},b.data("hijack"),a,f);c.hrefs=g.stringToBoolean(c.hrefs);c.forms=g.stringToBoolean(c.forms);b.data("hijack",c);var d=e.extend(!0,{},n,c);e("a, form",b).each(function(){c._parent=b;e(this).hijack(c)});g.isEmpty(d.target)&& (d.target=d._parent||b.parent());if(b.prop("tagName").match(/a/i))a:if(d.hrefs&&b.attr("href")&&!b.attr("href").match(/.*#$/)){if(b.data("_hijacked")){if(!d.canOverwrite)break a;b.unbind("click.hijack").data("_hijacked",!1)}b.bind("click.hijack",function(a){a.preventDefault();var c=e(d.target),f=g.isEmpty(d.context)?c:e(d.context);f._event=a;if(!h(d.confirmHijack,f))return!1;b.trigger("beforeHijack");h(d.beforeHijack,f,[d]);e.ajax({url:this.href,data:d.data,success:function(a,e,c){f=null;d.rehijack&& (a=j(a,d));g.isEmpty(a.error)?h(d.onSuccess,this,[a,e,c,d]):h(d.onError,this,[a,e,c,d]);b.trigger("afterHijack");h(d.afterHijack,this,[a])},context:f})}).data("_hijacked",!0)}if(b.prop("tagName").match(/form/i))a:if(d.forms){if(b.data("_hijacked")){if(!d.canOverwrite)break a;b.unbind("submit.hijack").data("_hijacked",!1)}var k=b.get(0);for(i=0;i<k.attributes.length;i++)if(k.attributes[i].specified){var f=k.attributes[i].nodeName.toString().toLowerCase(),m=f.match(/^on(submit)/);if(!g.isEmpty(m)){var m= m[1],p=new Function(k.attributes[i].nodeValue.toString());b.removeAttr(f);b.bind(m,function(){return p.apply()});f=e._data(b[0],"events").submit;f.unshift(f.pop())}}b.bind("submit.hijack",function(a){a.preventDefault();if(g.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var c=e._data(b[0],"events").submit;if("hijack"!=c[c.length-1].namespace){a.stopImmediatePropagation();for(var f=0;f<c.length;f++)if("hijack"!=c[f].namespace)c.splice(f,1),f--;else if("hijack"==c[f].namespace&& f+1!=c.length)return c.push(c.splice(f,1).pop()),b.triggerHandler("submit"),!1}var c=e(d.target),l=g.isEmpty(d.context)?c:e(d.context);l._event=a;if(!h(d.confirmHijack,l))return!1;b.trigger("beforeHijack");h(d.beforeHijack,l,[d]);e.ajax({url:k.action,data:b.serialize()+"&"+e.param(d.data),success:function(a,c,e){l=null;d.rehijack&&(a=j(a,d));g.isEmpty(a.error)?h(d.onSuccess,this,[a,c,e,d]):h(d.onError,this,[a,c,e,d]);b.trigger("afterHijack");h(d.afterHijack,this,[a])},context:l});return!1}).data("_hijacked", !0)}}})}})(jQuery);