/* Hijack v1.0.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
(function(f){var g={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||g.isNull(a)||g.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!g.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1; default:return Boolean(a)}},executeFunctionByName:function(a,f){var c=Array.prototype.slice.call(arguments,2);1>c.length&&(c=arguments);for(var d=a.split("."),g=d.pop(),b=window,k=0;k<d.length;k++)b=b[d[k]];try{return b[g].apply(f,c)}catch(l){return alert(l),null}}},m={hrefs:!0,forms:!0,data:null,recursive:!0,canRehijack:!0,target:null,context:null,removeOld:!0,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){f(this).html(a)},onError:function(a){alert("ERROR: "+ a)}};f.extend({hijackSetup:function(a){f.extend(!0,m,a)}});f.fn.hijack=function(a){a=a||{};var j=function(c,a,h){if(!g.isEmpty(c)){g.isEmpty(h)&&(h=arguments);if(f.isFunction(c))return c.apply(a,h);if(g.isString(c)){h=c.split(",");var b=h.shift();return g.executeFunctionByName(b,a,h)}}};return this.each(function(){var c=f(this),d=f.parseJSON(c.attr("data-hijack"));if(g.isBoolean(d)||g.isNumber(d))d={hrefs:d,forms:d};var h=f.extend(!0,{},c.data("hijack"),a,d);h.hrefs=g.stringToBoolean(h.hrefs);h.forms= g.stringToBoolean(h.forms);c.data("hijack",h);var b=f.extend(!0,{},m,h);f("a, form",c).each(function(){h._parent=c;f(this).hijack(h)});g.isEmpty(b.target)&&(b.target=b._parent||c.parent());if(c.prop("tagName").match(/a/i))a:if(b.hrefs&&c.attr("href")&&!c.attr("href").match(/.*#$/)){if(c.data("_hijacked")){if(!b.canRehijack)break a;c.unbind("click.hijack").data("_hijacked",!1)}c.bind("click.hijack",function(a){a.preventDefault();var e=f(b.target),e=g.isEmpty(b.context)?e:f(b.context);e._event=a;j(b.confirmHijack, e)&&(c.trigger("beforeHijack"),j(b.beforeHijack,e,[b]),f.ajax({url:this.href,data:b.data,success:function(a,e,d){b.removeOld&&f(this).children().empty().remove();g.isEmpty(a.error)?(j(b.onSuccess,this,[a,e,d]),b.recursive&&f(this).hijack(b)):j(b.onError,this,[a,e,d]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:e}))}).data("_hijacked",!0)}if(c.prop("tagName").match(/form/i))a:if(b.forms){if(c.data("_hijacked")){if(!b.canRehijack)break a;c.unbind("submit.hijack").data("_hijacked",!1)}var k= c.get(0);for(i=0;i<k.attributes.length;i++)if(k.attributes[i].specified){var d=k.attributes[i].nodeName.toString().toLowerCase(),l=d.match(/^on(submit)/);if(!g.isEmpty(l)){var l=l[1],n=new Function(k.attributes[i].nodeValue.toString());c.removeAttr(d);c.bind(l,function(){return n.apply()});d=f._data(c[0],"events").submit;d.unshift(d.pop())}}c.bind("submit.hijack",function(a){a.preventDefault();if(g.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var e=f._data(c[0],"events").submit; if("hijack"!=e[e.length-1].namespace){a.stopImmediatePropagation();for(var d=0;d<e.length;d++)if("hijack"!=e[d].namespace)e.splice(d,1),d--;else if("hijack"==e[d].namespace&&d+1!=e.length)return e.push(e.splice(d,1).pop()),c.triggerHandler("submit"),!1}e=f(b.target);e=g.isEmpty(b.context)?e:f(b.context);e._event=a;if(j(b.confirmHijack,e))return c.trigger("beforeHijack"),j(b.beforeHijack,e,[b]),f.ajax({url:k.action,data:c.serialize()+"&"+f.param(b.data),success:function(a,d,e){b.removeOld&&f(this).children().empty().remove(); g.isEmpty(a.error)?(j(b.onSuccess,this,[a,d,e]),b.recursive&&f(this).hijack(b)):j(b.onError,this,[a,d,e]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:e}),!1}).data("_hijacked",!0)}})}})(jQuery);