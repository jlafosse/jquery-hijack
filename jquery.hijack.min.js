/* Hijack v1.0.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(f){var g={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||g.isNull(a)||g.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!g.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1; default:return Boolean(a)}},executeFunctionByName:function(a,f){var c=Array.prototype.slice.call(arguments,2);1>c.length&&(c=arguments);for(var g=a.split("."),d=g.pop(),b=window,k=0;k<g.length;k++)b=b[g[k]];try{return b[d].apply(f,c)}catch(h){return alert(h),null}}},m={hrefs:!0,forms:!0,data:null,rehijack:!0,canOverwrite:!0,target:null,context:null,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){f(this).html(a)},onError:function(a){alert("ERROR: "+ a)}};f.extend({hijackSetup:function(a){f.extend(!0,m,a)}});f.fn.hijack=function(a){a=a||{};var j=function(c,a,d){if(!g.isEmpty(c)){g.isEmpty(d)&&(d=arguments);if(f.isFunction(c))return c.apply(a,d);if(g.isString(c)){d=c.split(",");var b=d.shift();return g.executeFunctionByName(b,a,d)}}};return this.each(function(){var c=f(this);if(!g.isEmpty(c.prop("tagName"))){var e=f.parseJSON(c.attr("data-hijack"));if(g.isBoolean(e)||g.isNumber(e))e={hrefs:e,forms:e};var d=f.extend(!0,{},c.data("hijack"),a,e); d.hrefs=g.stringToBoolean(d.hrefs);d.forms=g.stringToBoolean(d.forms);c.data("hijack",d);var b=f.extend(!0,{},m,d);f("a, form",c).each(function(){d._parent=c;f(this).hijack(d)});g.isEmpty(b.target)&&(b.target=b._parent||c.parent());if(c.prop("tagName").match(/a/i))a:if(b.hrefs&&c.attr("href")&&!c.attr("href").match(/.*#$/)){if(c.data("_hijacked")){if(!b.canOverwrite)break a;c.unbind("click.hijack").data("_hijacked",!1)}c.bind("click.hijack",function(a){a.preventDefault();var d=f(b.target),l=g.isEmpty(b.context)? d:f(b.context);l._event=a;if(!j(b.confirmHijack,l))return!1;c.trigger("beforeHijack");j(b.beforeHijack,l,[b]);f.ajax({url:this.href,data:b.data,success:function(a,d,e){l=null;b.rehijack&&f(this).hijack(b);g.isEmpty(a.error)?j(b.onSuccess,this,[a,d,e,b]):j(b.onError,this,[a,d,e,b]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:l})}).data("_hijacked",!0)}if(c.prop("tagName").match(/form/i))a:if(b.forms){if(c.data("_hijacked")){if(!b.canOverwrite)break a;c.unbind("submit.hijack").data("_hijacked", !1)}var k=c.get(0);for(i=0;i<k.attributes.length;i++)if(k.attributes[i].specified){var e=k.attributes[i].nodeName.toString().toLowerCase(),h=e.match(/^on(submit)/);if(!g.isEmpty(h)){var h=h[1],n=new Function(k.attributes[i].nodeValue.toString());c.removeAttr(e);c.bind(h,function(){return n.apply()});e=f._data(c[0],"events").submit;e.unshift(e.pop())}}c.bind("submit.hijack",function(a){a.preventDefault();if(g.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(),!1;var d=f._data(c[0], "events").submit;if("hijack"!=d[d.length-1].namespace){a.stopImmediatePropagation();for(var e=0;e<d.length;e++)if("hijack"!=d[e].namespace)d.splice(e,1),e--;else if("hijack"==d[e].namespace&&e+1!=d.length)return d.push(d.splice(e,1).pop()),c.triggerHandler("submit"),!1}var d=f(b.target),h=g.isEmpty(b.context)?d:f(b.context);h._event=a;if(!j(b.confirmHijack,h))return!1;c.trigger("beforeHijack");j(b.beforeHijack,h,[b]);f.ajax({url:k.action,data:c.serialize()+"&"+f.param(b.data),success:function(a,d, e){h=null;b.rehijack&&f(this).hijack(b);g.isEmpty(a.error)?j(b.onSuccess,this,[a,d,e,b]):j(b.onError,this,[a,d,e,b]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:h});return!1}).data("_hijacked",!0)}}})}})(jQuery);