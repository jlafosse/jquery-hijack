/* Hijack v1.0.0 - jQuery Plugin - Copyright (c) 2012 Jason LaFosse - Licensed under MIT and GPL */
;(function(f){var g={isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return""==a||g.isNull(a)||g.isUndefined(a)},isString:function(a){return"string"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},stringToBoolean:function(a){if(!g.isString(a))return a;switch(a.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1; default:return Boolean(a)}},executeFunctionByName:function(a,f){var c=Array.prototype.slice.call(arguments,2);1>c.length&&(c=arguments);for(var g=a.split("."),d=g.pop(),b=window,k=0;k<g.length;k++)b=b[g[k]];try{return b[d].apply(f,c)}catch(l){return alert(l),null}}},m={hrefs:!0,forms:!0,data:null,recursive:!0,canRehijack:!0,target:null,context:null,removeOld:!0,confirmHijack:function(){return!0},beforeHijack:function(){},afterHijack:function(){},onSuccess:function(a){f(this).html(a)},onError:function(a){alert("ERROR: "+ a)}};f.extend({hijackSetup:function(a){f.extend(!0,m,a)}});f.fn.hijack=function(a){a=a||{};var j=function(c,a,d){if(!g.isEmpty(c)){g.isEmpty(d)&&(d=arguments);if(f.isFunction(c))return c.apply(a,d);if(g.isString(c)){d=c.split(",");var b=d.shift();return g.executeFunctionByName(b,a,d)}}};return this.each(function(){var c=f(this);if(!g.isEmpty(c.prop("tagName"))){var h=f.parseJSON(c.attr("data-hijack"));if(g.isBoolean(h)||g.isNumber(h))h={hrefs:h,forms:h};var d=f.extend(!0,{},c.data("hijack"),a,h); d.hrefs=g.stringToBoolean(d.hrefs);d.forms=g.stringToBoolean(d.forms);c.data("hijack",d);var b=f.extend(!0,{},m,d);f("a, form",c).each(function(){d._parent=c;f(this).hijack(d)});g.isEmpty(b.target)&&(b.target=b._parent||c.parent());if(c.prop("tagName").match(/a/i))a:if(b.hrefs&&c.attr("href")&&!c.attr("href").match(/.*#$/)){if(c.data("_hijacked")){if(!b.canRehijack)break a;c.unbind("click.hijack").data("_hijacked",!1)}c.bind("click.hijack",function(a){a.preventDefault();var e=f(b.target),e=g.isEmpty(b.context)? e:f(b.context);e._event=a;j(b.confirmHijack,e)&&(c.trigger("beforeHijack"),j(b.beforeHijack,e,[b]),f.ajax({url:this.href,data:b.data,success:function(a,e,d){b.removeOld&&f(this).children().empty().remove();g.isEmpty(a.error)?(j(b.onSuccess,this,[a,e,d,b]),b.recursive&&f(this).hijack(b)):j(b.onError,this,[a,e,d,b]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:e}))}).data("_hijacked",!0)}if(c.prop("tagName").match(/form/i))a:if(b.forms){if(c.data("_hijacked")){if(!b.canRehijack)break a; c.unbind("submit.hijack").data("_hijacked",!1)}var k=c.get(0);for(i=0;i<k.attributes.length;i++)if(k.attributes[i].specified){var h=k.attributes[i].nodeName.toString().toLowerCase(),l=h.match(/^on(submit)/);if(!g.isEmpty(l)){var l=l[1],n=new Function(k.attributes[i].nodeValue.toString());c.removeAttr(h);c.bind(l,function(){return n.apply()});h=f._data(c[0],"events").submit;h.unshift(h.pop())}}c.bind("submit.hijack",function(a){a.preventDefault();if(g.isBoolean(a.result)&&!a.result)return a.stopImmediatePropagation(), !1;var e=f._data(c[0],"events").submit;if("hijack"!=e[e.length-1].namespace){a.stopImmediatePropagation();for(var d=0;d<e.length;d++)if("hijack"!=e[d].namespace)e.splice(d,1),d--;else if("hijack"==e[d].namespace&&d+1!=e.length)return e.push(e.splice(d,1).pop()),c.triggerHandler("submit"),!1}e=f(b.target);e=g.isEmpty(b.context)?e:f(b.context);e._event=a;if(j(b.confirmHijack,e))return c.trigger("beforeHijack"),j(b.beforeHijack,e,[b]),f.ajax({url:k.action,data:c.serialize()+"&"+f.param(b.data),success:function(a, d,e){b.removeOld&&f(this).children().empty().remove();g.isEmpty(a.error)?(j(b.onSuccess,this,[a,d,e,b]),b.recursive&&f(this).hijack(b)):j(b.onError,this,[a,d,e,b]);c.trigger("afterHijack");j(b.afterHijack,this,[a])},context:e}),!1}).data("_hijacked",!0)}}})}})(jQuery);